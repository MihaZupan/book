<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Telegram Bots</title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel="stylesheet" type="text/css">
        <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro:500" rel="stylesheet" type="text/css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
    </head>
    <body class="light">
        <!-- Provide site root to javascript -->
        <script type="text/javascript">var path_to_root = "";</script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { } 
            if (theme === null || theme === undefined) { theme = 'light'; }
            document.body.className = theme;
            document.querySelector('html').className = theme + ' js';
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <ol class="chapter"><li><a href="index.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li><ol class="section"><li><a href="1/quickstart.html"><strong aria-hidden="true">1.1.</strong> Quickstart</a></li><li><a href="1/example-bot.html"><strong aria-hidden="true">1.2.</strong> Example - First Chat Bot</a></li></ol></li><li><a href="2/index.html"><strong aria-hidden="true">2.</strong> Beginner</a></li><li><ol class="section"><li><a href="2/send-msg/index.html"><strong aria-hidden="true">2.1.</strong> Sending Messages</a></li><li><ol class="section"><li><a href="2/send-msg/text-msg.html"><strong aria-hidden="true">2.1.1.</strong> Text</a></li><li><a href="2/send-msg/photo-sticker-msg.html"><strong aria-hidden="true">2.1.2.</strong> Photo &amp; Sticker</a></li><li><a href="2/send-msg/audio-voice-msg.html"><strong aria-hidden="true">2.1.3.</strong> Audio &amp; Voice</a></li><li><a href="2/send-msg/video-video_note-msg.html"><strong aria-hidden="true">2.1.4.</strong> Video &amp; Video Note</a></li><li><a href="2/send-msg/album-msg.html"><strong aria-hidden="true">2.1.5.</strong> Album (Media Group)</a></li><li><a href="2/send-msg/document-animation-msg.html"><strong aria-hidden="true">2.1.6.</strong> Document &amp; Animation</a></li><li><a href="2/send-msg/other-msg.html"><strong aria-hidden="true">2.1.7.</strong> Other Messages</a></li></ol></li><li><a href="2/reply-markup.html"><strong aria-hidden="true">2.2.</strong> Reply Markup</a></li><li><a href="2/get-updates.html"><strong aria-hidden="true">2.3.</strong> Getting Updates</a></li></ol></li><li><a href="3/index.html"><strong aria-hidden="true">3.</strong> Intermediate</a></li><li><ol class="section"><li><a href="3/deploy/index.html"><strong aria-hidden="true">3.1.</strong> Deployment</a></li><li><ol class="section"><li><a href="3/deploy/polling.html"><strong aria-hidden="true">3.1.1.</strong> Long Polling</a></li><li><a href="3/deploy/webhook.html"><strong aria-hidden="true">3.1.2.</strong> Webhooks</a></li></ol></li><li><a href="3/tests.html"><strong aria-hidden="true">3.2.</strong> Systems Integration Tests</a></li><li><a href="3/inline.html"><strong aria-hidden="true">3.3.</strong> Inline Mode</a></li><li><a href="3/files/index.html"><strong aria-hidden="true">3.4.</strong> Files</a></li><li><ol class="section"><li><a href="3/files/download.html"><strong aria-hidden="true">3.4.1.</strong> Download</a></li><li><a href="3/files/upload.html"><strong aria-hidden="true">3.4.2.</strong> Upload</a></li></ol></li><li><a href="3/sticker.html"><strong aria-hidden="true">3.5.</strong> Stickers</a></li></ol></li><li><a href="4/index.html"><strong aria-hidden="true">4.</strong> Advanced</a></li><li><ol class="section"><li><a href="4/login-widget.html"><strong aria-hidden="true">4.1.</strong> Login Widget</a></li><li><a href="4/passport/index.html"><strong aria-hidden="true">4.2.</strong> Passport</a></li><li><ol class="section"><li><a href="4/passport/quickstart.html"><strong aria-hidden="true">4.2.1.</strong> Quickstart</a></li><li><a href="4/passport/files-docs.html"><strong aria-hidden="true">4.2.2.</strong> Files &amp; Documents</a></li><li><a href="4/passport/errors.html"><strong aria-hidden="true">4.2.3.</strong> Data Errors</a></li><li><a href="4/passport/key.html"><strong aria-hidden="true">4.2.4.</strong> RSA Key</a></li><li><a href="4/passport/faq.html"><strong aria-hidden="true">4.2.5.</strong> Decryption FAQ</a></li></ol></li><li><a href="4/proxy.html"><strong aria-hidden="true">4.3.</strong> Proxy</a></li><li><a href="4/log.html"><strong aria-hidden="true">4.4.</strong> Logging</a></li></ol></li><li><a href="Migration-Guide-to-Version-14.x.html"><strong aria-hidden="true">5.</strong> Migration guide =&gt; v14</a></li><li><a href="FAQ.html"><strong aria-hidden="true">6.</strong> FAQ</a></li></ol>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar" class="menu-bar">
                    <div id="menu-bar-sticky-container">
                        <div class="left-buttons">
                            <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                                <i class="fa fa-bars"></i>
                            </button>
                            <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                                <i class="fa fa-paint-brush"></i>
                            </button>
                            <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                                <li role="none"><button role="menuitem" class="theme" id="light">Light <span class="default">(default)</span></button></li>
                                <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                            </ul>
                            
                            <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                                <i class="fa fa-search"></i>
                            </button>
                            
                        </div>

                        <h1 class="menu-title">Telegram Bots</h1> 

                        <div class="right-buttons">
                            <a href="print.html" title="Print this book" aria-label="Print this book">
                                <i id="print-button" class="fa fa-print"></i>
                            </a>
                        </div>
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <a class="header" href="#telegram-bots-book" id="telegram-bots-book"><h1>Telegram Bots Book</h1></a>
<p><a href="https://www.nuget.org/packages/Telegram.Bot"><img src="https://img.shields.io/nuget/dt/Telegram.Bot.svg?style=flat-square" alt="NuGet" /></a>
<a href="https://github.com/TelegramBots/Telegram.Bot"><img src="https://img.shields.io/github/stars/TelegramBots/Telegram.Bot.svg?style=social&amp;label=Stars" alt="Repository" /></a></p>
<p><a href="https://github.com/TelegramBots/Telegram.Bot"><strong>Telegram.Bot</strong></a> is the most popular .NET Client for <a href="https://core.telegram.org/bots/api">Telegram Bot API</a>.</p>
<p>The Bot API is an HTTP-based interface created for developers keen on building bots for Telegram.
Check <a href="https://core.telegram.org/bots"><em>Bots: An introduction for developers</em></a> to understand what a Telegram bot is and what it can do.</p>
<p>We, <a href="https://github.com/orgs/TelegramBots/people">Telegram Bots team</a>, mainly focus on developing multiple <a href="https://www.nuget.org/profiles/TelegramBots">NuGet packages</a> for creating chatbots.</p>
<table><thead><tr><th align="center">Packages</th><th align="center">Team</th><th align="center">News Channel</th><th align="center">Group Chat</th></tr></thead><tbody>
<tr><td align="center"> <a href="https://www.nuget.org/profiles/TelegramBots"><img src="1/docs/logo-nuget.png" alt="Packages" /></a> </td><td align="center"> <a href="https://github.com/orgs/TelegramBots/people"><img src="1/docs/logo-gh.png" alt="Team" /></a> </td><td align="center"> <a href="https://t.me/tgbots_dotnet"><img src="1/docs/logo-channel.jpg" alt="News Channel" /></a> </td><td align="center"> <a href="https://t.me/joinchat/B35YY0QbLfd034CFnvCtCA"><img src="1/docs/logo-chat.jpg" alt="Group Chat" /></a> </td></tr>
<tr><td align="center"> Packages we release on NuGet </td><td align="center"> The team contributing to this work </td><td align="center"> Subscribe to <a href="https://t.me/tgbots_dotnet"><code>@tgbots_dotnet</code></a> channel to get our latest news </td><td align="center"> <a href="https://t.me/joinchat/B35YY0QbLfd034CFnvCtCA">Join our chat</a> to talk about bots and ask questions </td></tr>
</tbody></table>
<a class="header" href="#what-is-this-book-for" id="what-is-this-book-for"><h2>What Is This Book For</h2></a>
<p>All Bot API methods are already documented by Telegram<sup class="footnote-reference"><a href="#1">1</a></sup> but this book covers all you need to know to create a
chatbot in .NET. There are also many concrete examples written in C#.
The guides here can even be useful to bot developers using other languages/platforms as it shows best practices
in developing Telegram chatbots with examples.</p>
<a class="header" href="#correctness--testing" id="correctness--testing"><h2>Correctness &amp; Testing</h2></a>
<p>This project is fully tested using Unit tests and Systems Integration tests before each release.
In fact, our test cases are self-documenting and serve as examples for Bot API methods.
Once you learn the basics of Telegram chatbots, you will be able to easily understand the code in examples and
use it in your own bot program.</p>
<a class="header" href="#get-started" id="get-started"><h2>Get Started</h2></a>
<p><strong>Begin your bot development journey with the <a href="1/quickstart.html"><em>Quickstart</em></a> guide.</strong></p>
<hr />
<div class="footnote-definition" id="1"><sup class="footnote-definition-label">1</sup>
<p><a href="https://core.telegram.org/bots/api">Telegram Bot API</a></p>
</div>
<a class="header" href="#quickstart" id="quickstart"><h1>Quickstart</h1></a>
<a class="header" href="#bot-father" id="bot-father"><h2>Bot Father</h2></a>
<p>Before you start developing a bot, you need to talk to <a href="https://t.me/botfather"><code>@BotFather</code></a> on Telegram. Register a
bot with him and get an access token.</p>
<p><a href="https://t.me/botfather"><img src="docs/logo-bot-father.jpg" alt="Bot Father" /></a></p>
<p>Access token is a key used to identify and authorize your bot in API
requests so keep it with yourself as a secret. It looks like this:</p>
<pre><code class="language-text">1234567:4TT8bAc8GHUspu3ERYn-KGcvsvGB9u_n4ddy
</code></pre>
<a class="header" href="#hello-world" id="hello-world"><h2>Hello World</h2></a>
<p>Now you have a bot, it's time to bring it to life! Create a new console project for your bot.
It could be a .NET Core project or a .NET project targeting versions 4.5+.</p>
<blockquote>
<p>This guide uses .NET Core examples but full .NET framework projects work as well.</p>
</blockquote>
<pre><code class="language-bash">dotnet new console
</code></pre>
<p>Add a reference to <code>Telegram.Bot</code> package.</p>
<pre><code class="language-bash">dotnet add package Telegram.Bot
</code></pre>
<p>Open <code>Program.cs</code> file and use the following content. This code fetches Bot information based on its access token by calling <a href="https://core.telegram.org/bots/api#getme"><code>getMe</code></a> method on the Bot API.</p>
<blockquote>
<p>Replace <code>YOUR_ACCESS_TOKEN_HERE</code> with the access token from Bot Father.</p>
</blockquote>
<pre><code class="language-c#">using System;
using Telegram.Bot;

namespace Awesome {
  class Program {
    static void Main() {
      var botClient = new TelegramBotClient(&quot;YOUR_ACCESS_TOKEN_HERE&quot;);
      var me = botClient.GetMeAsync().Result;
      Console.WriteLine(
        $&quot;Hello, World! I am user {me.Id} and my name is {me.FirstName}.&quot;
      );
    }
  }
}
</code></pre>
<p>Running the program gives you the following output:</p>
<pre><code class="language-bash">dotnet run
</code></pre>
<pre><code class="language-text">Hello, World! I am user 1234567 and my name is Awesome Bot.
</code></pre>
<p>Great! This bot is self-aware. To make the bot interact with a user, head to the next page.</p>
<a class="header" href="#example---first-chat-bot" id="example---first-chat-bot"><h1>Example - First Chat Bot</h1></a>
<p>On the previous page, we got an access token and used the <a href="https://core.telegram.org/bots/api#getme"><code>getMe</code></a> method to check our setup.
Now, it is time to make an <em>interactive</em> bot that gets users' messages and replies to them like in this screenshot:</p>
<p><img src="docs/shot-example_bot.jpg" alt="Example Image" /></p>
<p>Copy the following code to <code>Program.cs</code>.</p>
<blockquote>
<p>Replace <code>YOUR_ACCESS_TOKEN_HERE</code> with the access token from Bot Father.</p>
</blockquote>
<pre><code class="language-c#">using System;
using System.Threading;
using Telegram.Bot;
using Telegram.Bot.Args;

namespace Awesome {
  class Program {
    static ITelegramBotClient botClient;

    static void Main() {
      botClient = new TelegramBotClient(&quot;YOUR_ACCESS_TOKEN_HERE&quot;);

      var me = botClient.GetMeAsync().Result;
      Console.WriteLine(
        $&quot;Hello, World! I am user {me.Id} and my name is {me.FirstName}.&quot;
      );

      botClient.OnMessage += Bot_OnMessage;
      botClient.StartReceiving();
      Thread.Sleep(int.MaxValue);
    }

    static async void Bot_OnMessage(object sender, MessageEventArgs e) {
      if (e.Message.Text != null)
      {
        Console.WriteLine($&quot;Received a text message in chat {e.Message.Chat.Id}.&quot;);

        await botClient.SendTextMessageAsync(
          chatId: e.Message.Chat,
          text:   &quot;You said:\n&quot; + e.Message.Text
        );
      }
    }
  }
}
</code></pre>
<p>Run the program.</p>
<pre><code class="language-bash">dotnet run
</code></pre>
<p>It runs for a long time waiting for text messages unless forcefully stopped. Open a private chat with your bot in
Telegram and send a text message to it. Bot should reply in no time.</p>
<p>In the code above, we subscribe to <code>OnMessage</code> event on bot client to take action on messages that users send to bot.</p>
<p>By invoking <code>StartReceiving()</code>, bot client starts fetching updates using <a href="https://core.telegram.org/bots/api#getupdates"><code>getUpdates</code></a> method for the bot
from Telegram Servers. This is an asynchronous operation so <code>Thread.Sleep()</code> is used right after that
to keep the app running for a while in this demo.</p>
<p>When a user sends a message, <code>Bot_OnMessage()</code> gets invoked with the message object passed via event arguments.
We are expecting a text message so we check for <code>Message.Text</code> value.
Finally, we send a text message back to the same chat we got the message from.</p>
<p>If you take a look at the console, the program outputs the <code>chatId</code> value. <strong>Copy the chat id number</strong> to make testing easier
for yourself in the next pages.</p>
<pre><code class="language-text">Received a text message in chat 123456789.
</code></pre>
<a class="header" href="#beginner" id="beginner"><h1>Beginner</h1></a>
<ul>
<li><a href="send-msg">Sending Messages</a>
<ul>
<li><a href="send-msg/text-msg.html">Text</a></li>
<li><a href="send-msg/photo-sticker-msg.html">Photo &amp; Sticker</a></li>
<li><a href="send-msg/audio-voice-msg.html">Audio &amp; Voice</a></li>
<li><a href="send-msg/video-video_note-msg.html">Video &amp; Video Note</a></li>
<li><a href="send-msg/album-msg.html">Album (Media Group)</a></li>
<li><a href="send-msg/document-animation-msg.html">Document &amp; Animation</a></li>
<li><a href="send-msg/other-msg.html">Other Messages</a></li>
</ul>
</li>
<li><a href="reply-markup.html">Reply Markup</a></li>
<li><a href="get-updates.html">Getting Updates</a></li>
</ul>
<a class="header" href="#sending-messages" id="sending-messages"><h1>Sending Messages</h1></a>
<p>There are many different types of message that a bot can send.
Fortunately, methods for sending such messages are similar. Take a look at these examples:</p>
<p><strong>Sending text message</strong>:</p>
<p><img src="../docs/shot-text_msg.jpg" alt="text message screenshot" /></p>
<pre><code class="language-c#">await botClient.SendTextMessageAsync(
  chatId: e.Message.Chat,
  text:   &quot;Hello, World!&quot;
);
</code></pre>
<p><strong>Sending sticker message</strong>:</p>
<p><img src="../docs/shot-sticker.jpg" alt="sticker message screenshot" /></p>
<pre><code class="language-c#">await botClient.SendStickerAsync(
  chatId:  e.Message.Chat,
  sticker: &quot;https://github.com/TelegramBots/book/raw/master/src/docs/sticker-dali.webp&quot;
);
</code></pre>
<p><strong>Sending video message</strong>:</p>
<p><img src="../docs/shot-video.jpg" alt="video message screenshot" /></p>
<pre><code class="language-c#">await botClient.SendVideAsync(
  chatId:  e.Message.Chat,
  video: &quot;https://github.com/TelegramBots/book/raw/master/src/docs/video-bulb.mp4&quot;
);
</code></pre>
<a class="header" href="#text-messages-and-more" id="text-messages-and-more"><h1>Text Messages and More</h1></a>
<p><a href="https://core.telegram.org/bots/api#sendmessage"><img src="https://img.shields.io/badge/Bot_API_method-send_message-blue.svg?style=flat-square" alt="send message method" /></a>
<a href="https://github.com/TelegramBots/Telegram.Bot/blob/master/test/Telegram.Bot.Tests.Integ/Sending%20Messages/TextMessageTests.cs"><img src="https://img.shields.io/badge/Examples-Text_Messages-green.svg?style=flat-square" alt="tests" /></a></p>
<p>Text is a powerful interface for your bot and <a href="https://core.telegram.org/bots/api#sendmessage"><code>sendMessage</code></a> probably is the most used method of the Telegram Bot API.
Text messages are easy to send and fast to display on devices with slower networking.
<em>Don't send boring plain text to users all the time</em>. Telegram allows you to format the text using Markdown or HTML.</p>
<a class="header" href="#send-text-message" id="send-text-message"><h2>Send Text Message</h2></a>
<p>The code snippet below sends a message with multiple parameters that looks like this:</p>
<p><img src="../docs/shot-text_msg2.jpg" alt="text message screenshot" /></p>
<blockquote>
<p>You can use this code snippet in the event handler from Example Bot page and use <code>e.Message.Chat</code>
or put the <code>chatId</code> value if you know it.</p>
</blockquote>
<pre><code class="language-c#">// using Telegram.Bot.Types;
// using Telegram.Bot.Types.Enums;
// using Telegram.Bot.Types.ReplyMarkups;

Message message = await botClient.SendTextMessageAsync(
  chatId: e.Message.Chat, // or a chat id: 123456789
  text: &quot;Trying *all the parameters* of `sendMessage` method&quot;,
  parseMode: ParseMode.Markdown,
  disableNotification: true,
  replyToMessageId: e.Message.MessageId,
  replyMarkup: new InlineKeyboardMarkup(InlineKeyboardButton.WithUrl(
    &quot;Check sendMessage method&quot;,
    &quot;https://core.telegram.org/bots/api#sendmessage&quot;
  ))
);
</code></pre>
<p>The method <code>SendTextMessageAsync</code> of .NET Bot Client maps to <a href="https://core.telegram.org/bots/api#sendmessage"><code>sendMessage</code></a> on Telegram's Bot API. This method sends a
text message and returns the message object sent.</p>
<p><code>text</code> is written in <a href="https://core.telegram.org/bots/api#markdown-style">MarkDown format</a> and <code>parseMode</code> indicates that. You can also write in HTML or plain text.</p>
<p>By passing <code>disableNotification</code> we tell Telegram client on user's device not to show/sound a notification.</p>
<p>It's a good idea to make it clear to a user the reason why the bot is sending this message and that's why we pass the user's
message id for <code>replyToMessageId</code>.</p>
<p>You have the option of specifying a <code>replyMarkup</code> when sending messages.
Reply markups are explained in details later in this book.
Here we used an <em>Inline Keyboard Markup</em> with a button that attaches to the message itself. Clicking that opens
<a href="https://core.telegram.org/bots/api#sendmessage"><code>sendMessage</code></a> method documentation in the browser.</p>
<a class="header" href="#the-message-sent" id="the-message-sent"><h2>The Message Sent</h2></a>
<p>Almost all of the methods for sending messages return you the message you just sent. Let's have a look at this
message object. Add this statement after the previous code.</p>
<pre><code class="language-c#">Console.WriteLine(
  $&quot;{message.From.FirstName} sent message {message.MessageId} &quot; +
  $&quot;to chat {message.Chat.Id} at {message.Date}. &quot; +
  $&quot;It is a reply to message {message.ReplyToMessage.MessageId} &quot; +
  $&quot;and has {message.Entities.Length} message entities.&quot;
);
</code></pre>
<p>Output should look similar to this:</p>
<pre><code class="language-text">Awesome bot sent message 123 to chat 123456789 at 8/21/18 11:25:09 AM. It is a reply to message 122 and has 2 message entities.
</code></pre>
<p>There are a few things to note.</p>
<p>Date and time is in <a href="https://en.wikipedia.org/wiki/Coordinated_Universal_Time">UTC format</a> and not your local timezone.
Convert it to local time by calling <code>message.Date.ToLocalTime()</code> method.</p>
<p><a href="https://core.telegram.org/bots/api#messageentity">Message Entity</a> refers to those formatted parts of the text: <em>all the parameters</em> in bold and
<em>sendMessage</em> in mono-width font.
Property <code>message.Entities</code> holds the formatting information and <code>message.EntityValues</code> gives you the actual value.
For example, in the message we just sent:</p>
<pre><code class="language-c#">message.Entities.First().Type == MessageEntityType.Bold
message.EntityValues.First()  == &quot;all the parameters&quot;
</code></pre>
<p>Currently, message object doesn't contain information about its reply markup.</p>
<p>Try putting a breakpoint in the code to examine all the properties on a message objects you get.</p>
<a class="header" href="#photo-and-sticker-messages" id="photo-and-sticker-messages"><h1>Photo and Sticker Messages</h1></a>
<p>You can provide the source file for almost all multimedia messages (e.g. photo, video) in 3 ways:</p>
<ul>
<li>Uploading a file with the HTTP request</li>
<li>HTTP URL for Telegram to get a file from the internet</li>
<li><code>file_id</code> of an existing file on Telegram servers (<em>recommended</em>)</li>
</ul>
<p>Examples in this section show all three.
You will learn more about them later on when we discuss file upload and download.</p>
<a class="header" href="#photo" id="photo"><h2>Photo</h2></a>
<p><a href="https://core.telegram.org/bots/api#sendphoto"><img src="https://img.shields.io/badge/Bot_API_method-send_photo-blue.svg?style=flat-square" alt="send photo method" /></a>
<a href="https://github.com/TelegramBots/Telegram.Bot/blob/master/test/Telegram.Bot.Tests.Integ/Sending%20Messages/SendingPhotoMessageTests.cs"><img src="https://img.shields.io/badge/Examples-Photo_Messages-green.svg?style=flat-square" alt="photo tests" /></a></p>
<p>Sending a photo is simple. Here is an example:</p>
<pre><code class="language-c#">Message message = await botClient.SendPhotoAsync(
  chatId: e.Message.Chat,
  photo: &quot;https://github.com/TelegramBots/book/raw/master/src/docs/photo-ara.jpg&quot;,
  caption: &quot;&lt;b&gt;Ara bird&lt;/b&gt;. &lt;i&gt;Source&lt;/i&gt;: &lt;a href=\&quot;https://pixabay.com\&quot;&gt;Pixabay&lt;/a&gt;&quot;,
  parseMode: ParseMode.Html
);
</code></pre>
<p><img src="../docs/shot-photo_msg.jpg" alt="photo message" /></p>
<a class="header" href="#caption" id="caption"><h3>Caption</h3></a>
<p>Multimedia messages can <em>optionally</em> have a caption attached to them. Here we sent a caption in HTML format.
A user can click on <em>Pixabay</em> in the caption to open its URL in the browser.</p>
<p>Similar to message entities discussed before, caption entities on <a href="https://core.telegram.org/bots/api#message"><code>Message</code></a> object are the result of
parsing formatted(Markdown or HTML) caption text.
Try inspecting these properties in debug mode:</p>
<ul>
<li><code>message.Caption</code>: caption in plain text without formatting</li>
<li><code>message.CaptionEntities</code>: info about special entities in the caption</li>
<li><code>message.CaptionEntityValues</code>: text values of mentioned entities</li>
</ul>
<a class="header" href="#photo-message" id="photo-message"><h3>Photo Message</h3></a>
<p>The <code>message</code> returned from this method represents a <em>photo message</em> because <code>message.Photo</code> has a value.
Its value is a <a href="https://core.telegram.org/bots/api#photosize"><code>PhotoSize</code></a> array with each element representing the same photo in different dimensions.
If your bot needs to send this photo again at some point, it is recommended to store this array
so you can reuse the <code>file_id</code> value.</p>
<p>Here is how <code>message.Photo</code> array looks like in JSON:</p>
<pre><code class="language-json">[
  {
    &quot;file_id&quot;: &quot;AgADBAADDqgxG-QDDVCm5JVvld7MN0z6kBkABCQawlb-dBXqBZUEAAEC&quot;,
    &quot;file_size&quot;: 1254,
    &quot;width&quot;: 90,
    &quot;height&quot;: 60
  },
  {
    &quot;file_id&quot;: &quot;AgADBAADDqgxG-QDDVCm5JVvld7MN0z6kBkABAKByRnc22RmBpUEAAEC&quot;,
    &quot;file_size&quot;: 16419,
    &quot;width&quot;: 320,
    &quot;height&quot;: 213
  },
  {
    &quot;file_id&quot;: &quot;AgADBAADDqgxG-QDDVCm5JVvld7MN0z6kBkABHezqGiNOz9yB5UEAAEC&quot;,
    &quot;file_size&quot;: 57865,
    &quot;width&quot;: 640,
    &quot;height&quot;: 426
  }
]
</code></pre>
<a class="header" href="#sticker" id="sticker"><h2>Sticker</h2></a>
<p><a href="https://core.telegram.org/bots/api#sendsticker"><img src="https://img.shields.io/badge/Bot_API_method-send_sticker-blue.svg?style=flat-square" alt="send sticker method" /></a>
<a href="https://github.com/TelegramBots/Telegram.Bot/blob/master/test/Telegram.Bot.Tests.Integ/Stickers/StickersTests.cs"><img src="https://img.shields.io/badge/Examples-Sticker_Messages-green.svg?style=flat-square" alt="sticker tests" /></a></p>
<p>Telegram stickers are fun and our bot is about to send its very first sticker.
Sticker files should be in <a href="https://developers.google.com/speed/webp/">WebP</a> format.</p>
<p>This code sends the same sticker twice. First by passing HTTP URL to a <a href="https://developers.google.com/speed/webp/">WebP</a> sticker file and
second by reusing <code>file_id</code> of the same sticker on Telegram servers.</p>
<pre><code class="language-c#">Message msg1 = await botClient.SendStickerAsync(
  chatId: e.Message.Chat,
  sticker: &quot;https://github.com/TelegramBots/book/raw/master/src/docs/sticker-fred.webp&quot;
);

Message msg2 = await botClient.SendStickerAsync(
  chatId: e.Message.Chat,
  sticker: msg1.Sticker.FileId
);
</code></pre>
<p><img src="../docs/shot-sticker_msgs.jpg" alt="sticker messages" /></p>
<p>Try inspecting the <code>msg1.Sticker</code> property. It is of type <a href="https://core.telegram.org/bots/api#sticker"><code>Sticker</code></a> and its schema looks similar to a photo.</p>
<blockquote>
<p>There is more to stickers and we will talk about them in greater details later.</p>
</blockquote>
<!-- -------------- -->
<a class="header" href="#audio-and-voice-messages" id="audio-and-voice-messages"><h1>Audio and Voice Messages</h1></a>
<p><a href="https://github.com/TelegramBots/Telegram.Bot/blob/master/test/Telegram.Bot.Tests.Integ/Sending%20Messages/AudioMessageTests.cs"><img src="https://img.shields.io/badge/Examples-Audio_Messages-green.svg?style=flat-square" alt="audio tests" /></a></p>
<p>These two types of messages are pretty similar. An audio is in MP3 format and gets displayed in music player.
A voice file has OGG format and is not shown in music player.</p>
<a class="header" href="#audio" id="audio"><h2>Audio</h2></a>
<p><a href="https://core.telegram.org/bots/api#sendaudio"><img src="https://img.shields.io/badge/Bot_API_method-send_audio-blue.svg?style=flat-square" alt="send audio method" /></a></p>
<p>This is the code to send an MP3 soundtrack. You might be wondering why some parameters are commented out.
That's because this MP3 file has metadata on it and Telegram does a good job at reading them.</p>
<pre><code class="language-c#">Message msg = await botClient.SendAudioAsync(
  e.Message.Chat,
  &quot;https://github.com/TelegramBots/book/raw/master/src/docs/audio-guitar.mp3&quot;
  /* ,
  performer: &quot;Joel Thomas Hunger&quot;,
  title: &quot;Fun Guitar and Ukulele&quot;,
  duration: 91 // in seconds
  */
);
</code></pre>
<p><img src="../docs/shot-audio_msg.jpg" alt="audio message" /></p>
<p>And a user can see the audio in Music Player:</p>
<p><img src="../docs/shot-music_player.jpg" alt="music player" /></p>
<p>Method returns an audio message. Let's take a look at the value of <code>msg.Audio</code> property in JSON format:</p>
<pre><code class="language-json">{
  &quot;duration&quot;: 91,
  &quot;mime_type&quot;: &quot;audio/mpeg&quot;,
  &quot;title&quot;: &quot;Fun Guitar and Ukulele&quot;,
  &quot;performer&quot;: &quot;Joel Thomas Hunger&quot;,
  &quot;file_id&quot;: &quot;CQADBAADKQADA3oUUKalqDOOcqesAg&quot;,
  &quot;file_size&quot;: 1102154
}
</code></pre>
<a class="header" href="#voice" id="voice"><h2>Voice</h2></a>
<p><a href="https://core.telegram.org/bots/api#sendvoice"><img src="https://img.shields.io/badge/Bot_API_method-send_voice-blue.svg?style=flat-square" alt="send voice method" /></a></p>
<p>A voice message is just an OGG audio file.
Let's send it differently this time by uploading the file from disk alongside with an HTTP request.</p>
<p>To run this example, download the <a href="https://raw.githubusercontent.com/TelegramBots/book/master/src/docs/voice-nfl_commentary.ogg">NFL Commentary voice file</a> to your disk.</p>
<p>A value is passed for <code>duration</code> because Telegram can't figure that out from a file's metadata.</p>
<pre><code class="language-c#">Message msg;
using (var stream = System.IO.File.OpenRead(&quot;/path/to/voice-nfl_commentary.ogg&quot;)) {
  msg = await botClient.SendVoiceAsync(
    chatId: e.Message.Chat,
    voice: stream,
    duration: 36
  );
}
</code></pre>
<p><img src="../docs/shot-voice_msg.jpg" alt="voice message" /></p>
<p>A voice message is returned from the method. Inspect the <code>msg.Voice</code> property to learn more.</p>
<a class="header" href="#video-and-video-note-messages" id="video-and-video-note-messages"><h1>Video and Video Note Messages</h1></a>
<p><a href="https://github.com/TelegramBots/Telegram.Bot/blob/master/test/Telegram.Bot.Tests.Integ/Sending%20Messages/VideoMessageTests.cs"><img src="https://img.shields.io/badge/Examples-Video_Messages-green.svg?style=flat-square" alt="tests" /></a></p>
<p>You can send MP4 files as a regular video or a <em>video note</em>.
Other video formats may be sent as documents.</p>
<a class="header" href="#video" id="video"><h2>Video</h2></a>
<p><a href="https://core.telegram.org/bots/api#sendvideo"><img src="https://img.shields.io/badge/Bot_API_method-send_video-blue.svg?style=flat-square" alt="method sendVideo" /></a></p>
<p>Videos, like other multimedia messages, can have caption, reply, reply markup, and etc.
You can optionally specify the duration and resolution of the video.</p>
<p>In the example below, we send a video of a 10 minute countdown
and expect the Telegram clients to stream that long video instead of downloading it completely.
We also set a thumbnail image for our video.</p>
<pre><code class="language-c#">Message msg = await botClient.SendVideoAsync(
  chatId: e.Message.Chat,
  video: &quot;https://raw.githubusercontent.com/TelegramBots/book/master/src/docs/video-countdown.mp4&quot;,
  thumb: &quot;https://raw.githubusercontent.com/TelegramBots/book/master/src/2/docs/thumb-clock.jpg&quot;,
  supportsStreaming: true
);
</code></pre>
<blockquote>
<p>Check the Bot API docs for <code>sendVideo</code> to learn more about video size limits and the thumbnail images.</p>
</blockquote>
<p><img src="../docs/shot-video_thumb1.jpg" alt="vide screenshot 1" /></p>
<p>User should be able to seek through the video without the video being downloaded completely.</p>
<p><img src="../docs/shot-video_thumb2.jpg" alt="vide screenshot 2" /></p>
<a class="header" href="#video-note" id="video-note"><h2>Video Note</h2></a>
<p><a href="https://core.telegram.org/bots/api#sendvideonote"><img src="https://img.shields.io/badge/Bot_API_method-send_video_note-blue.svg?style=flat-square" alt="method sendVideoNote" /></a></p>
<p>Video notes, shown in circles to the user, are usually short (1 minute or less) with the same width and height.</p>
<p>You can send a video note only by uploading the video file or reusing the <code>file_id</code> of another video note.
Sending video note by its HTTP URL is not supported currently.</p>
<p>Download the <a href="https://raw.githubusercontent.com/TelegramBots/book/master/src/docs/video-waves.mp4">Sea Waves video</a> to your disk for this example.</p>
<pre><code class="language-c#">Message msg;
using (var stream = System.IO.File.OpenRead(&quot;/path/to/video-waves.mp4&quot;)) {
  msg = await botClient.SendVideoNoteAsync(
    chatId: e.Message.Chat,
    videoNote: stream,
    duration: 47,
    length: 360 // value of width/height
  );
}
</code></pre>
<p><img src="../docs/shot-video_note.jpg" alt="vide note screenshot" /></p>
<a class="header" href="#album-messages" id="album-messages"><h1>Album Messages</h1></a>
<a class="header" href="#document-and-animation-messages" id="document-and-animation-messages"><h1>Document and Animation Messages</h1></a>
<a class="header" href="#document" id="document"><h2>Document</h2></a>
<a class="header" href="#animation" id="animation"><h2>Animation</h2></a>
<a class="header" href="#other-messages" id="other-messages"><h1>Other Messages</h1></a>
<a class="header" href="#contact" id="contact"><h2>Contact</h2></a>
<a class="header" href="#venue" id="venue"><h2>Venue</h2></a>
<a class="header" href="#location" id="location"><h2>Location</h2></a>
<a class="header" href="#reply-markup" id="reply-markup"><h1>Reply Markup</h1></a>
<a class="header" href="#getting-updates" id="getting-updates"><h1>Getting Updates</h1></a>
<a class="header" href="#intermediate" id="intermediate"><h1>Intermediate</h1></a>
<a class="header" href="#deployment" id="deployment"><h1>Deployment</h1></a>
<a class="header" href="#long-polling" id="long-polling"><h1>Long Polling</h1></a>
<a class="header" href="#webhooks" id="webhooks"><h1>Webhooks</h1></a>
<a class="header" href="#systems-integration-tests" id="systems-integration-tests"><h1>Systems Integration Tests</h1></a>
<p>Integration tests are meant to test the project with real data from Telegram. They are semi-automated tests and tester(s) need to interact with bot for some cases during the test execution. Tests could be used as a playground for exploring Bot API methods.</p>
<a class="header" href="#sample-test-diagnostics-output" id="sample-test-diagnostics-output"><h2>Sample Test Diagnostics Output</h2></a>
<p>All the test output goes into the supergroup/private chats specified in configurations or interactively during test execution. You can see some samples of test output below.</p>
<p>Admin bots can change chat photo.</p>
<p><img src="docs/testcase-chatphoto.jpg" alt="Test Case: Set Chat Photo" /></p>
<p>Invoices could be paid in private chats.</p>
<p><img src="docs/testcase-payment.jpg" alt="Test Case: Set Chat Photo" /></p>
<a class="header" href="#how-tests-works" id="how-tests-works"><h2>How Tests Works</h2></a>
<p>These integration tests are written just like regular unit tests with xUnit framework so they seem to be unit tests. When you run test(s), bot makes a request to Bot API and you should see results(message or service notification) in the chat with bot.</p>
<p>When you build the solution, you will see them in Test Explorer window. Tests could be run through .NET Core's CLI as well and that's how this project's CI is set up.</p>
<p>A bot, of course, is needed to test Bot API. This document refers to its user name as <em>MyTestBot</em>.</p>
<p><em>Tester</em> refers to user name of person testing the bot. Multiple testers could interact with bot during
test execution. If super group chat has other members that are not listed as testers, bot ignores their
messages during test execution. Testers must have user names assigned and their user names should be set
in test configurations before hand.</p>
<p>All the tests happen in two chats. A Super Group chat and a Private chat with one of the testers.</p>
<p>Test cases that need tester's interaction to continue, have a limit of usually 2 minues to wait for receving an expected update from API.</p>
<p>Tests could be run individually, in collections, or all at once. All the test collection and test cases whithin them are ordered and tests will not run in parallel.</p>
<a class="header" href="#test-environment-setup" id="test-environment-setup"><h2>Test Environment Setup</h2></a>
<p>Create a Super Group and add bot to it. Promote bot to admin and make sure it has all the permissions. This group needs to have another regular(non-admin) member to be used in tests for chat administration methods(such as Kick, Restrict, Unban). A super group with 2 testers in it, one admin and the other non-admin member, is enough.</p>
<p>Bot should have some features enabled, usually through BotFather, in order to pass tests. These features are listed below:</p>
<ul>
<li>Inline Queries</li>
<li>Payment Provider</li>
</ul>
<p>For making testing process more convenient, set the following commands for MyTestBot as well. The purpose for these commands is explained in the sections below.</p>
<pre><code class="language-text">test - Start test execution
  me - Select me for testing admin methods
</code></pre>
<a class="header" href="#test-configurations" id="test-configurations"><h2>Test Configurations</h2></a>
<p>You can see a list of configuration keys in <code>appsettings.json</code> file. Make a copy of this file and store your configurations there. In addition to <code>appsettings.json</code> and <code>appsettings.Development.json</code>, environment variables prefixed by <code>TelegramBot_</code> are also read into program.</p>
<pre><code class="language-bash">cp appsettings.json appsettings.Development.json
</code></pre>
<a class="header" href="#required-settings" id="required-settings"><h3>Required Settings</h3></a>
<p>Only 2 values must be provided before test execution.</p>
<a class="header" href="#api-token" id="api-token"><h4>API Token</h4></a>
<p>This is required for executing any test case.</p>
<pre><code class="language-json">{
    &quot;ApiToken&quot;: &quot;MyTestBot-API-TOKEN&quot;
    /* ... */
}
</code></pre>
<a class="header" href="#allowed-users" id="allowed-users"><h4>Allowed Users</h4></a>
<p>A comma separated list indicating user name(s) of tester(s). Any update coming from users other than the ones listed here are discarded during test execution.</p>
<pre><code class="language-json">{
    /* ... */
    &quot;AllowedUserNames&quot;: &quot;tester1, Tester2, TESTER3&quot;
    /* ... */
}
</code></pre>
<a class="header" href="#optional-settings" id="optional-settings"><h3>Optional Settings</h3></a>
<p>The following settings are not required for two reasons. Either bot can ask for them during test execution or it is not a required setting for all test cases.</p>
<p>Bot will ask testers in supergroup/private chat for the necessary information. It would be faster to set all the optional settings as well because it makes testing process faster and less manual.</p>
<blockquote>
<p>For obtaining values of necessary settings, you can set breakpoints in some test methods and extract values such as chat id or user id.</p>
</blockquote>
<a class="header" href="#supergroup-chat-id" id="supergroup-chat-id"><h4>Supergroup Chat Id</h4></a>
<p>Bot send  messages to this chat in almost all test cases except cases like sending payments that must be to a private chat.</p>
<p>If not set, before starting any test method, bot waits for a tester to send it a <code>/test</code> command in a super group chat (that bot is also a member of).</p>
<pre><code class="language-json">{
    /* ... */
    &quot;SuperGroupChatId&quot;: -1234567890
    /* ... */
}
</code></pre>
<a class="header" href="#payment-settings" id="payment-settings"><h4>Payment Settings</h4></a>
<a class="header" href="#required-payment-provider-token" id="required-payment-provider-token"><h5>[Required] Payment Provider Token</h5></a>
<p>This token is <strong>required</strong> for any test case regarding payments and must be provided before starting tests.</p>
<p>Consult Telegram API documentations and talk to BotFather to get a test token from a payment provider.</p>
<pre><code class="language-json">{
    /* ... */
    &quot;PaymentProviderToken&quot;: &quot;MY-PAYMENT-PROVIDER-TOKEN&quot;
    /* ... */
}
</code></pre>
<a class="header" href="#testerprivatechatid" id="testerprivatechatid"><h5>TesterPrivateChatId</h5></a>
<p>Invoices could only be sent to private chats. If not set, bot will wait for a tester to send it <code>/test</code> command in a private chat.</p>
<pre><code class="language-json">{
    /* ... */
    &quot;TesterPrivateChatId&quot;: 1234567890
    /* ... */
}
</code></pre>
<a class="header" href="#chat-administration" id="chat-administration"><h4>Chat Administration</h4></a>
<p>For this type of tests, bot should be a priviledged admin of that super group. Methods such as kick or unban will be performed on a regular (non-admin) tester in that chat.</p>
<p>If the following 3 settings are not set, bot will ask a tester to send it <code>/me</code> command in a private chat with bot.</p>
<ul>
<li>Regular Member's User Id</li>
<li>Regular Member's User Name</li>
<li>Regular Member's Private Chat Id</li>
</ul>
<pre><code class="language-json">{
    /* ... */
    &quot;RegularMemberUserId&quot;: 1234567890,
    &quot;RegularMemberUserName&quot;: &quot;tester3&quot;,
    &quot;RegularMemberPrivateChatId&quot;: 1234567890
    /* ... */
}
</code></pre>
<a class="header" href="#inline-mode" id="inline-mode"><h1>Inline Mode</h1></a>
<a class="header" href="#working-with-files" id="working-with-files"><h1>Working with Files</h1></a>
<p>First, read the <a href="https://core.telegram.org/bots/api#getfile">documentation on <code>getFile</code></a>.</p>
<p>To download a file you will need its ID.</p>
<a class="header" href="#finding-the-fileid" id="finding-the-fileid"><h2>Finding the FileId</h2></a>
<p>There are many file objects in the Telegram Bot API:
<a href="https://core.telegram.org/bots/api#document"><code>Document</code></a>, <a href="https://core.telegram.org/bots/api#audio"><code>Audio</code></a>, <a href="https://core.telegram.org/bots/api#voice"><code>Voice</code></a>, <a href="https://core.telegram.org/bots/api#video"><code>Video</code></a>, <a href="https://core.telegram.org/bots/api#videonote"><code>VideoNote</code></a>, <a href="https://core.telegram.org/bots/api#animation"><code>Animation</code></a>, <a href="https://core.telegram.org/bots/api#sticker"><code>Sticker</code></a>, <code>Photo</code>.</p>
<p>The FileId for each will be found in their <code>FileId</code> property (E.g. <code>Message.Audio.FileId</code>).</p>
<p>The exception to that is the Photo, which is a <a href="https://core.telegram.org/bots/api#photosize"><code>PhotoSize[]</code></a>.
Telegram sends you a few different resolutions for each photo that you can choose from.
Generaly, you will want the highest quality - the last <a href="https://core.telegram.org/bots/api#photosize"><code>PhotoSize</code></a> in the array.
Using Linq, this boils down to <code>Message.Photo.Last().FileId</code>.</p>
<a class="header" href="#downloading-a-file" id="downloading-a-file"><h2>Downloading a file</h2></a>
<p>Downloading a file from Telegram servers is done in two steps:</p>
<ol>
<li>Calling <code>getFile</code> to receive a URL from which we can download the file</li>
<li>Downloading the file</li>
</ol>
<p>Calling <code>Bot.GetFileAsync(fileId)</code> will return a <a href="https://core.telegram.org/bots/api#file"><code>File</code></a> object that contains a <code>file_path</code>.</p>
<p>The URL from which you can now download the file is <code>https://api.telegram.org/file/bot&lt;token&gt;/&lt;file_path&gt;</code>.</p>
<p>The library provides you with a helper function that does both - <code>GetInfoAndDownloadFileAsync</code>.</p>
<a class="header" href="#downloading-into-a-filestream" id="downloading-into-a-filestream"><h2>Downloading into a FileStream</h2></a>
<pre><code class="language-csharp">using (FileStream fs = System.IO.File.OpenWrite(&quot;File.pdf&quot;))
    await Bot.GetInfoAndDownloadFileAsync(message.Document.FileId, fs);
</code></pre>
<a class="header" href="#downloading-to-a-byte-array" id="downloading-to-a-byte-array"><h2>Downloading to a byte array</h2></a>
<pre><code class="language-csharp">byte[] document = await Bot.GetInfoAndDownloadFileAsync(message.Document.FileId);
</code></pre>
<p>First, read the <a href="https://core.telegram.org/bots/api#sending-files">documentation on sending files</a>.</p>
<a class="header" href="#uploading-the-actual-file" id="uploading-the-actual-file"><h2>Uploading the actual file</h2></a>
<pre><code class="language-csharp">using (FileStream fs = System.IO.File.OpenRead(&quot;Local file.pdf&quot;))
{
    InputOnlineFile inputOnlineFile = new InputOnlineFile(fs, &quot;Name for the user.pdf&quot;);
    await Bot.SendDocumentAsync(message.Chat, inputOnlineFile);
}
</code></pre>
<a class="header" href="#uploading-by-file-id" id="uploading-by-file-id"><h2>Uploading by file id</h2></a>
<p>This is the method that you will want to use the most, as it is the most efficient.
After sending a file to the user, or receiving a file, you can send the file again using its ID.</p>
<p>This saves you from uploading the entire file.</p>
<pre><code class="language-csharp">InputOnlineFile inputOnlineFile = new InputOnlineFile(&quot;file id&quot;);
await Bot.SendDocumentAsync(message.Chat, inputOnlineFile);
</code></pre>
<a class="header" href="#uploading-by-url" id="uploading-by-url"><h2>Uploading by URL</h2></a>
<pre><code class="language-csharp">InputOnlineFile inputOnlineFile = new InputOnlineFile(&quot;telegram.org/img/t_logo.png&quot;);
await Bot.SendDocumentAsync(message.Chat, inputOnlineFile);
</code></pre>
<a class="header" href="#stickers" id="stickers"><h1>Stickers</h1></a>
<a class="header" href="#advanced" id="advanced"><h1>Advanced</h1></a>
<ul>
<li><a href="login-widget.html">Login Widget</a></li>
<li><a href="passport">Passport</a>
<ul>
<li><a href="passport/quickstart.html">Quickstart</a></li>
<li><a href="passport/files-docs.html">Files &amp; Documents</a></li>
<li><a href="passport/errors.html">Data Errors</a></li>
<li><a href="passport/key.html">RSA Key</a></li>
<li><a href="passport/faq.html">Decryption FAQ</a></li>
</ul>
</li>
<li><a href="proxy.html">Proxy</a></li>
<li><a href="log.html">Logging</a></li>
</ul>
<a class="header" href="#telegram-login-widget" id="telegram-login-widget"><h1>Telegram Login Widget</h1></a>
<p>Everything related to the <a href="https://core.telegram.org/widgets/login">Telegram Login Widget</a> has been moved to a separate repository:
<a href="https://github.com/TelegramBots/Telegram.Bot.Extensions.LoginWidget"><code>Telegram.Bot.Extensions.LoginWidget</code></a></p>
<a class="header" href="#telegram-passport" id="telegram-passport"><h1>Telegram Passport</h1></a>
<p><a href="https://www.nuget.org/packages/Telegram.Bot.Extensions.Passport"><img src="https://img.shields.io/nuget/v/Telegram.Bot.Extensions.Passport.svg?style=flat-square" alt="nuget package" /></a>
<a href="https://www.nuget.org/packages/Telegram.Bot.Extensions.Passport"><img src="https://img.shields.io/nuget/dt/Telegram.Bot.Extensions.Passport.svg?style=flat-square" alt="nuget downloads" /></a>
<a href="https://github.com/TelegramBots/Telegram.Bot.Extensions.Passport"><img src="https://img.shields.io/github/stars/TelegramBots/Telegram.Bot.Extensions.Passport.svg?style=social&amp;label=Stars" alt="repository" /></a></p>
<ul>
<li><a href="quickstart.html">Quickstart</a></li>
<li><a href="files-docs.html">Files &amp; Documents</a></li>
<li><a href="errors.html">Data Errors</a></li>
<li><a href="key.html">RSA Key</a></li>
<li><a href="faq.html">Decryption FAQ</a></li>
</ul>
<p><img src="../docs/photo-tg_passport.gif" alt="telegram passport" /></p>
<p><a href="https://telegram.org/blog/passport">Telegram Passport</a> is a unified authorization method for services that require personal identification.
As a bot developer, you can use it to receive confidential user data in an end-to-end encrypted fashion.
There are several Know Your Customer(KYC) solutions that have already added support for Telegram Passport.</p>
<p>This guide is targeted at bot developers and assumes the audience is already familiar with:</p>
<ul>
<li><a href="https://telegram.org/blog/passport">Telegram Passport</a></li>
<li><a href="https://core.telegram.org/passport/example">Telegram Passport Example</a></li>
<li><a href="https://core.telegram.org/passport">Telegram Passport Manual</a></li>
</ul>
<a class="header" href="#telegram-passport---quickstart" id="telegram-passport---quickstart"><h1>Telegram Passport - Quickstart</h1></a>
<p><a href="https://github.com/TelegramBots/Telegram.Bot.Extensions.Passport/tree/master/src/Quickstart/Program.cs"><img src="https://img.shields.io/badge/Examples-Passport_Quickstart-green.svg?style=flat-square" alt="passport quickstart example" /></a></p>
<p>This guide teaches the basics of working with Telegram Passport.
See the complete version of the code at <a href="https://github.com/TelegramBots/Telegram.Bot.Extensions.Passport/tree/master/src/Quickstart">Quickstart project</a>.
Code snippets on this page are in the context of that project.</p>
<a class="header" href="#package" id="package"><h2>Package</h2></a>
<p><a href="https://www.nuget.org/packages/Telegram.Bot.Extensions.Passport"><img src="https://img.shields.io/nuget/v/Telegram.Bot.Extensions.Passport.svg?style=flat-square" alt="nuget package" /></a></p>
<p>You need to add <code>Telegram.Bot.Extensions.Passport</code> extension package to your project
in addition to the core package (<code>Telegram.Bot</code>).</p>
<p>⭐️ Star the <a href="https://github.com/TelegramBots/Telegram.Bot.Extensions.Passport">Telegram.Bot.Extensions.Passport project</a> on GitHub 👍</p>
<pre><code class="language-bash">dotnet add package Telegram.Bot.Extensions.Passport
</code></pre>
<a class="header" href="#encryption-keys" id="encryption-keys"><h2>Encryption Keys</h2></a>
<p>You don't really need to generate any RSA key. Use our sample keys for this demo.
Send the public key to <a href="https://t.me/BotFather">@BotFather</a> using <code>/setpublickey</code> command:</p>
<p><img src="../docs/shot-passport_botfather.jpg" alt="Setting public key" /></p>
<p>Copy this public key and send it to BotFather.</p>
<pre><code class="language-text">-----BEGIN PUBLIC KEY-----
MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA0VElWoQA2SK1csG2/sY/
wlssO1bjXRx+t+JlIgS6jLPCefyCAcZBv7ElcSPJQIPEXNwN2XdnTc2wEIjZ8bTg
BlBqXppj471bJeX8Mi2uAxAqOUDuvGuqth+mq7DMqol3MNH5P9FO6li7nZxI1FX3
9u2r/4H4PXRiWx13gsVQRL6Clq2jcXFHc9CvNaCQEJX95jgQFAybal216EwlnnVV
giT/TNsfFjW41XJZsHUny9k+dAfyPzqAk54cgrvjgAHJayDWjapq90Fm/+e/DVQ6
BHGkV0POQMkkBrvvhAIQu222j+03frm9b2yZrhX/qS01lyjW4VaQytGV0wlewV6B
FwIDAQAB
-----END PUBLIC KEY-----
</code></pre>
<p>Now Telegram client app can encrypt the data for your bot using this key.</p>
<a class="header" href="#request-information" id="request-information"><h2>Request Information</h2></a>
<p>Bot waits for a text message from user. Once it receives a text message, it generates an authorization request link
and sends that to the user.</p>
<a class="header" href="#authorization-request" id="authorization-request"><h3>Authorization Request</h3></a>
<p><a href="https://core.telegram.org/passport#request-parameters"><img src="https://img.shields.io/badge/Passport_API_type-Request_Parameters-blue.svg?style=flat-square" alt="Request Parameters type" /></a></p>
<p>A passport authorization request means that the bot should ask the user to open a <code>tg://resolve</code> URI in the browser
with specific parameters in its query string.
You can alternatively have a button in an HTML page on your website for that.</p>
<p>Type <a href="https://github.com/TelegramBots/Telegram.Bot.Extensions.Passport/blob/master/src/Telegram.Bot.Extensions.Passport/Request/AuthorizationRequestParameters.cs">AuthorizationRequestParameters</a>  helps you in creating such an URI.</p>
<pre><code class="language-c#">AuthorizationRequestParameters authReq = new AuthorizationRequestParameters(
  botId: 123456, // bot user ID
  publicKey: &quot;...&quot;, // public key in PEM format. same as the key above.
  nonce: &quot;unique nonce for this request&quot;,
  scope: new PassportScope(new[] { // a PassportScope object
    new PassportScopeElementOne(&quot;address&quot;),
    new PassportScopeElementOne(&quot;phone_number&quot;)
  })
);
</code></pre>
<p>In <a href="https://github.com/TelegramBots/Telegram.Bot.Extensions.Passport/blob/master/src/Quickstart/Program.cs">SendAuthorizationRequestAsync</a> method, we ask for <code>address</code> and <code>phone_number</code> scopes.
Then, we generate the query string and ask user to open the link.</p>
<p>You might be wondering what is the magic in here?</p>
<p><a href="https://telegrambots.github.io/Telegram.Bot.Extensions.Passport/redirect.html">https://telegrambots.github.io/Telegram.Bot.Extensions.Passport/redirect.html</a></p>
<p>This web page redirects user to <code>tg://resolve</code> URI, appending whatever query string was passed to it.</p>
<blockquote>
<p>If a user is using an Android device, the URI will start with <code>tg:</code> instead of the default <code>tg://</code>.</p>
</blockquote>
<p><img src="../docs/shot-passport_link1.jpg" alt="Passport link 1" />
<img src="../docs/shot-passport_link2.jpg" alt="Passport link 2" /></p>
<a class="header" href="#passport-data" id="passport-data"><h3>Passport Data</h3></a>
<p>You, the user, should now be redirected to the Telegram Passport screen in your Telegram client app.
Enter your password and log in.</p>
<blockquote>
<p>Note that the app will ask you to register if this is the first time you are using Telegram Passport.</p>
</blockquote>
<p><img src="../docs/shot-passport_login.jpg" alt="Passport login" /></p>
<p>Fill in the <em>address</em> and <em>phone number</em> data. Click on the <em>Authorize</em> button at the end.</p>
<p><img src="../docs/shot-passport_adress_phone1.jpg" alt="Passport info 1" />
<img src="../docs/shot-passport_adress.jpg" alt="address info" />
<img src="../docs/shot-passport_phone.jpg" alt="phone info" />
<img src="../docs/shot-passport_adress_phone2.jpg" alt="Passport info 2" /></p>
<p>At this point, your Telegram client app encrypts the actual Telegram Passport data (e.g. address) using the
AES algorithm, and then encrypts the info required for decryption using your bot's public RSA key.
Finally, it sends the result of both encryptions to Telegram servers.</p>
<a class="header" href="#data-decryption" id="data-decryption"><h3>Data Decryption</h3></a>
<p><a href="https://core.telegram.org/bots/api#passportdata"><img src="https://img.shields.io/badge/Bot_API_type-Passport_Data-blue.svg?style=flat-square" alt="Passport Data type" /></a></p>
<p>Your bot now receives a new message update with the encrypted Passport data. The user is also notified in the chat:</p>
<p><img src="../docs/shot-passport_update.jpg" alt="Passport update" /></p>
<p>Let's decrypt that gibberish to get the information. That's what <a href="https://github.com/TelegramBots/Telegram.Bot.Extensions.Passport/blob/master/src/Quickstart/Program.cs">DecryptPassportDataAsync</a> method does.</p>
<a class="header" href="#step-1-credentials" id="step-1-credentials"><h4>Step 1: Credentials</h4></a>
<p><a href="https://core.telegram.org/bots/api#encryptedcredentials"><img src="https://img.shields.io/badge/Bot_API_type-EncryptedCredentials-blue.svg?style=flat-square" alt="EncryptedCredentials type" /></a>
<a href="https://core.telegram.org/passport#credentials"><img src="https://img.shields.io/badge/Passport_API_type-Credentials-blue.svg?style=flat-square" alt="Credentials type" /></a></p>
<p>You can't just access the encrypted data in the <code>message.passport_data.data</code> array.
Required parameters for their decryption are in the <code>message.passport_data.credentials</code> object.
But that credentials object is encrypted using bot's public key!</p>
<p>We first take the bot's <em>private key</em> this time and decrypt the credentials.</p>
<blockquote>
<p>There are more details about importing a key in PEM format on the <a href="key.html">RSA Key page</a>.</p>
</blockquote>
<pre><code class="language-c#">IDecrypter decrypter = new Decrypter();
Credentials credentials = decrypter.DecryptCredentials(
  message.PassportData.Credentials, // EncryptedCredentials object
  GetRsaPrivateKey() // private key as an RSA object
);
</code></pre>
<a class="header" href="#step-2-nonce" id="step-2-nonce"><h4>Step 2: Nonce</h4></a>
<p><a href="https://core.telegram.org/passport#credentials"><img src="https://img.shields.io/badge/Passport_API_type-Credentials-blue.svg?style=flat-square" alt="Credentials type" /></a>
<a href="https://core.telegram.org/passport#request-parameters"><img src="https://img.shields.io/badge/Passport_API_type-Request_Parameters-blue.svg?style=flat-square" alt="Request Parameters type" /></a></p>
<p>There is a <code>nonce</code> property on the credentials (now decrypted) object.
In order to prevent certain attacks, ensure its value is exactly the same as the nonce you set in the authorization request.
Read more about <a href="https://en.wikipedia.org/wiki/Cryptographic_nonce">nonce on Wikipedia</a>.</p>
<a class="header" href="#step-3-residential-address" id="step-3-residential-address"><h4>Step 3: Residential Address</h4></a>
<p><a href="https://core.telegram.org/bots/api#encryptedpassportelement"><img src="https://img.shields.io/badge/Bot_API_type-EncryptedPassportElement-blue.svg?style=flat-square" alt="EncryptedPassportElement type" /></a>
<a href="https://core.telegram.org/passport#residentialaddress"><img src="https://img.shields.io/badge/Passport_API_type-ResidentialAddress-blue.svg?style=flat-square" alt="ResidentialAddress type" /></a></p>
<p><a href="https://core.telegram.org/passport#securedata"><img src="https://img.shields.io/badge/Passport_API_type-SecureData-blue.svg?style=flat-square" alt="SecureData type" /></a>
<a href="https://core.telegram.org/passport#securevalue"><img src="https://img.shields.io/badge/Passport_API_type-SecureValue-blue.svg?style=flat-square" alt="SecureValue type" /></a>
<a href="https://core.telegram.org/passport#datacredentials"><img src="https://img.shields.io/badge/Passport_API_type-DataCredentials-blue.svg?style=flat-square" alt="DataCredentials type" /></a></p>
<p>It's finally time to see the user's address.
We are looking for an encrypted element with type of <em>address</em> in <code>message.passport_data.data</code> array.
Also, decryption parameters for that are in <code>credentials.secure_data.address.data</code>.
Here is how the decryption magic happens:</p>
<pre><code class="language-c#">EncryptedPassportElement addressElement = message.PassportData.Data.Single(
  el =&gt; el.Type == PassportEnums.Scope.Address
);
ResidentialAddress address = decrypter.DecryptData&lt;ResidentialAddress&gt;(
  encryptedData: addressElement.Data,
  dataCredentials: credentials.SecureData.Address.Data
);
</code></pre>
<p><a href="https://github.com/TelegramBots/Telegram.Bot.Extensions.Passport/blob/master/src/Telegram.Bot.Extensions.Passport/Decryption/IDecrypter.cs">DecryptData</a> method does 3 tasks here:</p>
<ol>
<li>Decrypts the data into a JSON-serialized string</li>
<li>Verifies that the data hashes match</li>
<li>Converts from JSON to a .NET object</li>
</ol>
<a class="header" href="#step-4-phone-number" id="step-4-phone-number"><h4>Step 4: Phone Number</h4></a>
<p><a href="https://core.telegram.org/bots/api#encryptedpassportelement"><img src="https://img.shields.io/badge/Bot_API_type-EncryptedPassportElement-blue.svg?style=flat-square" alt="EncryptedPassportElement type" /></a></p>
<p>Values for phone number and email address are not end-to-end encrypted in Telegram Passport and
Telegram stores these values after being verified.</p>
<p>There is no need for decryption at this point.
Just find the element with the type of <em>phone_number</em> in the <code>message.passport_data.data</code> array.</p>
<a class="header" href="#information-demo" id="information-demo"><h3>Information Demo</h3></a>
<p>At the end, bot sends some of the information received to the user for demo purposes.</p>
<p><img src="../docs/shot-passport_quickstart.jpg" alt="info demo" /></p>
<!-- ----------- -->
<a class="header" href="#passport-files-and-documents" id="passport-files-and-documents"><h1>Passport Files and Documents</h1></a>
<p><a href="https://github.com/TelegramBots/Telegram.Bot.Extensions.Passport/blob/master/test/IntegrationTests/Single%20Scope%20Requests/Driver%20License%20Tests.cs"><img src="https://img.shields.io/badge/Examples-Driver_License_Scope-green.svg?style=flat-square" alt="driver's license scope tests" /></a></p>
<p>We use the driver's license scope here to show decryption of <em>ID document data</em> and <em>passport files</em> for
front side scan, reverse side scan, selfie photo, and translation scan.
That should cover most of the <a href="https://core.telegram.org/passport#fields">field types in Telegram Passport</a>.</p>
<p>Sections below are referring to the test methods in <a href="https://github.com/TelegramBots/Telegram.Bot.Extensions.Passport/blob/master/test/IntegrationTests/Single%20Scope%20Requests/Driver%20License%20Tests.cs">Driver's License Scope Tests</a> collection.
Here are the steps:</p>
<ol>
<li><a href="#authorization-request">Authorization Request</a></li>
<li><a href="#drivers-license-info">Driver's License Info</a></li>
<li><a href="#passport-message">Passport Message</a></li>
<li><a href="#credentials">Credentials</a></li>
<li><a href="#id-document-data">ID Document Data</a></li>
<li><a href="#passport-file">Passport File</a>
<ul>
<li><a href="#front-side-file">Front Side File</a></li>
<li><a href="#reverse-side-file">Reverse Side File</a></li>
<li><a href="#selfie-file">Selfie File</a></li>
<li><a href="#translation-file">Translation File</a></li>
</ul>
</li>
</ol>
<a class="header" href="#authorization-request-1" id="authorization-request-1"><h2>Authorization Request</h2></a>
<p><a href="https://core.telegram.org/passport#passportscope"><img src="https://img.shields.io/badge/Passport_API_type-PassportScope-blue.svg?style=flat-square" alt="PassportScope type" /></a>
<a href="https://core.telegram.org/passport#passportscopeelementone"><img src="https://img.shields.io/badge/Passport_API_type-PassportScopeElementOne-blue.svg?style=flat-square" alt="PassportScopeElementOne type" /></a></p>
<p><a href="https://github.com/TelegramBots/Telegram.Bot.Extensions.Passport/blob/master/test/IntegrationTests/Single%20Scope%20Requests/Driver%20License%20Tests.cs"><img src="https://img.shields.io/badge/Test_Method-Generate_Auth_Link-green.svg?style=flat-square" alt="method Should_Generate_Auth_Link" /></a></p>
<p>We start by generating an authorization URI.
Since a driver's license is considered as a proof of identity, we ask for optional data <em>selfie with document</em> and
<em>translation document scan</em> as well.</p>
<p><img src="../docs/shot-passport_driver_license_link.jpg" alt="driver's license passport link" /></p>
<a class="header" href="#drivers-license-info" id="drivers-license-info"><h2>Driver's License Info</h2></a>
<p>As a user, provide information for the required fields: front side, reverse side, and document number.
Also, test methods here expect a selfie photo and a file for translation scan.</p>
<p><img src="../docs/shot-passport_driver_license1.jpg" alt="driver's license passport 1" />
<img src="../docs/shot-passport_driver_license2.jpg" alt="driver's license passport 2" />
<img src="../docs/shot-passport_driver_license3.jpg" alt="driver's license passport 3" /></p>
<p>Click the <em>Authorize</em> button at the end.</p>
<a class="header" href="#passport-message" id="passport-message"><h2>Passport Message</h2></a>
<p><a href="https://core.telegram.org/bots/api#passportdata"><img src="https://img.shields.io/badge/Bot_API_type-Passport_Data-blue.svg?style=flat-square" alt="Passport Data type" /></a></p>
<p><a href="https://github.com/TelegramBots/Telegram.Bot.Extensions.Passport/blob/master/test/IntegrationTests/Single%20Scope%20Requests/Driver%20License%20Tests.cs"><img src="https://img.shields.io/badge/Test_Method-Validate_Passport_Update-green.svg?style=flat-square" alt="method Should_validate_passport_update" /></a></p>
<p>This test method checks for a Passport message with a driver's license element on it.</p>
<a class="header" href="#credentials" id="credentials"><h2>Credentials</h2></a>
<p><a href="https://core.telegram.org/bots/api#encryptedcredentials"><img src="https://img.shields.io/badge/Bot_API_type-EncryptedCredentials-blue.svg?style=flat-square" alt="EncryptedCredentials type" /></a>
<a href="https://core.telegram.org/passport#credentials"><img src="https://img.shields.io/badge/Passport_API_type-Credentials-blue.svg?style=flat-square" alt="Credentials type" /></a></p>
<p><a href="https://github.com/TelegramBots/Telegram.Bot.Extensions.Passport/blob/master/test/IntegrationTests/Single%20Scope%20Requests/Driver%20License%20Tests.cs"><img src="https://img.shields.io/badge/Test_Method-Decrypt_Credentials-green.svg?style=flat-square" alt="method Should_decrypt_credentials" /></a></p>
<p>We decrypt credentials using the RSA private key and verify that the same nonce is used.</p>
<pre><code class="language-c#">RSA key = EncryptionKey.ReadAsRsa();
IDecrypter decrypter = new Decrypter();
Credentials credentials = decrypter.DecryptCredentials(
  passportData.Credentials,
  key
);
bool isSameNonce = credentials.Nonce == &quot;Test nonce for driver's license&quot;;
</code></pre>
<a class="header" href="#id-document-data" id="id-document-data"><h2>ID Document Data</h2></a>
<p><a href="https://core.telegram.org/passport#iddocumentdata"><img src="https://img.shields.io/badge/Passport_API_type-IdDocumentData-blue.svg?style=flat-square" alt="IdDocumentData type" /></a></p>
<p><a href="https://github.com/TelegramBots/Telegram.Bot.Extensions.Passport/blob/master/test/IntegrationTests/Single%20Scope%20Requests/Driver%20License%20Tests.cs"><img src="https://img.shields.io/badge/Test_Method-Decreypt_Document_Data-green.svg?style=flat-square" alt="method Should_decreypt_document_data" /></a></p>
<p>In our test case, there is only 1 item in the <code>message.passport_data.data</code> array and that's the encrypted element for
the driver's license scope.
We can get information such as document number and expiry date for the license from that element:</p>
<pre><code class="language-c#">IdDocumentData licenseDoc = decrypter.DecryptData&lt;IdDocumentData&gt;(
  encryptedData: element.Data,
  dataCredentials: credentials.SecureData.DriverLicense.Data
);
</code></pre>
<a class="header" href="#passport-file" id="passport-file"><h2>Passport File</h2></a>
<p><a href="https://core.telegram.org/bots/api#passportfile"><img src="https://img.shields.io/badge/Bot_API_type-PassportFile-blue.svg?style=flat-square" alt="PassportFile type" /></a>
<a href="https://core.telegram.org/passport#filecredentials"><img src="https://img.shields.io/badge/Passport_API_type-FileCredentials-blue.svg?style=flat-square" alt="FileCredentials type" /></a></p>
<p>Passport file is an encrypted JPEG file on Telegram servers.
You need to download the passport file and decrypt it using its accompanying <em>file credentials</em> to see
the actual JPEG file content.
In this section we try to demonstrate different use cases that you might have for such files.</p>
<p>No matter the method used, the underlying decryption logic is the same.
It really comes down to your decision on working with <em>streams</em> vs. <em>byte arrays</em>.
<a href="https://github.com/TelegramBots/Telegram.Bot.Extensions.Passport/blob/master/src/Telegram.Bot.Extensions.Passport/Decryption/IDecrypter.cs">IDecrypter</a> gives you both options.</p>
<a class="header" href="#front-side-file" id="front-side-file"><h3>Front Side File</h3></a>
<p><a href="https://github.com/TelegramBots/Telegram.Bot.Extensions.Passport/blob/master/test/IntegrationTests/Single%20Scope%20Requests/Driver%20License%20Tests.cs"><img src="https://img.shields.io/badge/Test_Method-Decreypt_Front_Side_File-green.svg?style=flat-square" alt="method Should_decreypt_front_side_file" /></a></p>
<p>A pretty handy extension method is used here to stream writing the front side file to disk.
Method <a href="https://github.com/TelegramBots/Telegram.Bot.Extensions.Passport/blob/master/src/Telegram.Bot.Extensions.Passport/TelegramBotClientPassportExtensions.cs">DownloadAndDecryptPassportFileAsync</a> does a few things:</p>
<ol>
<li>Makes an HTTP request to fetch the encrypted file's info using its <em>passport file_id</em></li>
<li>Makes an HTTP request to download the encrypted file using its <em>file_path</em></li>
<li>Decrypts the encrypted file</li>
<li>Writes the actual content to the destination stream</li>
</ol>
<pre><code class="language-c#">File encryptedFileInfo;
using (System.IO.Stream stream = System.IO.File.OpenWrite(&quot;/path/to/front-side.jpg&quot;))
{
  encryptedFileInfo = await BotClient.DownloadAndDecryptPassportFileAsync(
    element.FrontSide, // PassportFile object for front side
    credentials.SecureData.DriverLicense.FrontSide, // front side FileCredentials
    stream // destination stream for writing the JPEG content to
  );
}
</code></pre>
<blockquote>
<p><strong>Warning</strong>: This method is convenient to use but gives you the least amount of control over the operations.</p>
</blockquote>
<a class="header" href="#reverse-side-file" id="reverse-side-file"><h3>Reverse Side File</h3></a>
<p><a href="https://github.com/TelegramBots/Telegram.Bot.Extensions.Passport/blob/master/test/IntegrationTests/Single%20Scope%20Requests/Driver%20License%20Tests.cs"><img src="https://img.shields.io/badge/Test_Method-Decreypt_Reverse_Side_File-green.svg?style=flat-square" alt="method Should_decreypt_reverse_side_file" /></a></p>
<p>Previous method call is divided into two operations here for reverse side of the license.
Streams are used here as well.</p>
<pre><code class="language-c#">File encryptedFileInfo;
using (System.IO.Stream
  encryptedContent = new System.IO.MemoryStream(element.ReverseSide.FileSize),
  decryptedFile = System.IO.File.OpenWrite(&quot;/path/to/reverse-side.jpg&quot;)
) {
  // fetch the encrypted file info and download it to memory
  encryptedFileInfo = await BotClient.GetInfoAndDownloadFileAsync(
    element.ReverseSide.FileId, // file_id of passport file for reverse side
    encryptedContent // stream to copy the encrypted file into
  );
  // ensure memory stream is at the beginning before reading from it
  encryptedContent.Position = 0;

  // decrypt the file and write it to disk
  await decrypter.DecryptFileAsync(
    encryptedContent,
    credentials.SecureData.DriverLicense.ReverseSide, // reverse side FileCredentials
    decryptedFile // destination stream for writing the JPEG content to
  );
}
</code></pre>
<a class="header" href="#selfie-file" id="selfie-file"><h3>Selfie File</h3></a>
<p><a href="https://github.com/TelegramBots/Telegram.Bot.Extensions.Passport/blob/master/test/IntegrationTests/Single%20Scope%20Requests/Driver%20License%20Tests.cs"><img src="https://img.shields.io/badge/Test_Method-Decreypt_Selfie_File-green.svg?style=flat-square" alt="method Should_decreypt_selfie_file" /></a></p>
<p>We deal with selfie photo as a byte array.
This is essentially the same operation as done above via streams.
We also post the selfie photo to a chat.</p>
<pre><code class="language-c#">// fetch the info of the passport file(selfie) residing on Telegram servers
File encryptedFileInfo = await BotClient.GetFileAsync(element.Selfie.FileId);

// download the encrypted file and get its bytes
byte[] encryptedContent;
using (System.IO.MemoryStream
  stream = new System.IO.MemoryStream(encryptedFileInfo.FileSize)
)
{
  await BotClient.DownloadFileAsync(encryptedFileInfo.FilePath, stream);
  encryptedContent = stream.ToArray();
}

// decrypt the content and get bytes of the actual selfie photo
byte[] selfieContent = decrypter.DecryptFile(
  encryptedContent,
  credentials.SecureData.DriverLicense.Selfie
);

// send the photo to a chat
using (System.IO.Stream stream = new System.IO.MemoryStream(selfieContent)) {
  await BotClient.SendPhotoAsync(
    123456,
    stream,
    &quot;selfie with driver's license&quot;
  );
}
</code></pre>
<a class="header" href="#translation-file" id="translation-file"><h3>Translation File</h3></a>
<p><a href="https://github.com/TelegramBots/Telegram.Bot.Extensions.Passport/blob/master/test/IntegrationTests/Single%20Scope%20Requests/Driver%20License%20Tests.cs"><img src="https://img.shields.io/badge/Test_Method-Decreypt_Translation_File-green.svg?style=flat-square" alt="method Should_decreypt_translation_file" /></a></p>
<p>A bot can request certified English translations of a document.
Translations are also encrypted passport files so their decryption is no different from others passport files.</p>
<p>Assuming that the user sends one translation scan only for the license, we receive the translation passport file object in
<code>message.passport_data.data[0].translation[0]</code> and its accompanying file credentials object in
<code>credentials.secure_data.driver_license.translation[0]</code>.</p>
<p>File gets written to disk as a byte array.</p>
<pre><code class="language-c#">PassportFile passportFile = element.Translation[0];
FileCredentials fileCreds = credentials.SecureData.DriverLicense.Translation[0];

// fetch passport file info
File encryptedFileInfo = await BotClient.GetFileAsync(passportFile.FileId);

// download encrypted file and get its bytes
byte[] encryptedContent;
using (System.IO.MemoryStream
  stream = new System.IO.MemoryStream(encryptedFileInfo.FileSize)
)
{
  await BotClient.DownloadFileAsync(encryptedFileInfo.FilePath, stream);
  encryptedContent = stream.ToArray();
}

// decrypt the content and get bytes of the actual selfie photo
byte[] content = decrypter.DecryptFile(
  encryptedContent,
  fileCreds
);

// write the file to disk
await System.IO.File.WriteAllBytesAsync(&quot;/path/to/translation.jpg&quot;, content);
</code></pre>
<!-- ----------- -->
<a class="header" href="#passport-data-errors" id="passport-data-errors"><h1>Passport Data Errors</h1></a>
<a class="header" href="#import-rsa-key" id="import-rsa-key"><h1>Import RSA Key</h1></a>
<p>In order to decrypt the credentials you need to provide the private RSA key to <a href="https://github.com/TelegramBots/Telegram.Bot.Extensions.Passport/blob/master/src/Telegram.Bot.Extensions.Passport/Decryption/IDecrypter.cs">DecryptCredentials</a> method.
If you have the RSA key in <a href="https://en.wikipedia.org/wiki/Privacy-Enhanced_Mail">PEM format</a>, you cannot simply instantiate an <a href="https://docs.microsoft.com/en-us/dotnet/api/system.security.cryptography.rsa?redirectedfrom=MSDN&amp;view=netstandard-2.0">RSA .NET object</a> from it.
Here we discuss two ways of importing your PEM private key.</p>
<a class="header" href="#from-pem-format" id="from-pem-format"><h2>From PEM Format</h2></a>
<p>This is the easier option and recommended <strong>for development time only</strong>.
We can generate an <a href="https://docs.microsoft.com/en-us/dotnet/api/system.security.cryptography.rsa?redirectedfrom=MSDN&amp;view=netstandard-2.0">RSA .NET object</a> from an RSA Key in PEM format using the <a href="https://www.nuget.org/packages/BouncyCastle/">BouncyCastle package</a>.</p>
<pre><code class="language-bash">dotnet add package BouncyCastle
</code></pre>
<p><a href="http://www.bouncycastle.org/csharp/index.html"><img src="../docs/photo-bouncy_castle.gif" alt="bouncy castle c# logo" /></a></p>
<p>Code snippet here shows the conversion from a PEM file to the needed RSA object.</p>
<pre><code class="language-c#">// using System.IO;
// using System.Security.Cryptography;
// using Org.BouncyCastle.Crypto;
// using Org.BouncyCastle.Crypto.Parameters;
// using Org.BouncyCastle.OpenSsl;
// using Org.BouncyCastle.Security;

static RSA GetPrivateKey() {
  string privateKeyPem = File.ReadAllText(&quot;/path/to/private-key.pem&quot;);
  PemReader pemReader = new PemReader(new StringReader(privateKeyPem));
  AsymmetricCipherKeyPair keyPair = (AsymmetricCipherKeyPair) pemReader.ReadObject();
  RSAParameters rsaParameters = DotNetUtilities
    .ToRSAParameters(keyPair.Private as RsaPrivateCrtKeyParameters);
  RSA rsa = RSA.Create(rsaParameters);
  return rsa;
}
</code></pre>
<blockquote>
<p><strong>Note</strong>: You don't necessarily need to have a dependency on the <a href="https://www.nuget.org/packages/BouncyCastle/">BouncyCastle package</a> in your bot project.
The section below offers a better alternative.</p>
</blockquote>
<a class="header" href="#from-rsa-parameters" id="from-rsa-parameters"><h2>From RSA Parameters</h2></a>
<p>We recommend to JSON-serialize <a href="https://docs.microsoft.com/en-us/dotnet/api/system.security.cryptography.rsaparameters?view=netstandard-2.0">RSAParameters</a> of your key and create an RSA object using its values without any
dependency on the <a href="https://www.nuget.org/packages/BouncyCastle/">BouncyCastle package</a> in production deployment.</p>
<p>Copy <a href="https://github.com/TelegramBots/Telegram.Bot.Extensions.Passport/blob/master/src/Quickstart/EncryptionKeyUtility.cs">EncryptionKeyUtility</a> and <a href="https://github.com/TelegramBots/Telegram.Bot.Extensions.Passport/blob/master/src/Quickstart/EncryptionKeyParameters.cs">EncryptionKeyParameters</a> files from our Quickstart project.
Those help with serialization.</p>
<p>You still need to <strong>use BouncyCastle only once</strong> to read the RSA key in PEM format and serialize its parameters:</p>
<pre><code class="language-c#">// ONLY ONCE: read the RSA private key and serialize its parameters to JSON
static void WriteRsaParametersToJson() {
  string privateKeyPem = System.IO.File.ReadAllText(&quot;/path/to/private-key.pem&quot;);
  string json = EncryptionKeyUtility.SerializeRsaParameters(privateKeyPem);
  System.IO.File.WriteAllText(&quot;/path/to/private-key-params.json&quot;, json);
}

// Now, read the JSON file and create an RSA instance
static RSA GetRsaKey() {
  string json = System.IO.File.ReadAllText(&quot;/path/to/private-key-params.json&quot;);
  return EncryptionKeyUtility.GetRsaKeyFromJson(json);
}
</code></pre>
<p>Content of <code>private-key-params.json</code> will look similar to this:</p>
<pre><code class="language-json">{
  &quot;E&quot;: &quot;AQAB&quot;,
  &quot;M&quot;: &quot;0VElW...Fw==&quot;,
  &quot;P&quot;: &quot;56Mdiw...i7FSwDaM=&quot;,
  &quot;Q&quot;: &quot;51UN2sd...J44NTf0=&quot;,
  &quot;D&quot;: &quot;nrXEeOl2Ky...JIQ==&quot;,
  &quot;DP&quot;: &quot;KZYZWbsy.../lk60=&quot;,
  &quot;DQ&quot;: &quot;Y25KgzPj...AdBd0=&quot;,
  &quot;IQ&quot;: &quot;0153...N6Y=&quot;
}
</code></pre>
<p>It's worth mentioning that <a href="https://github.com/TelegramBots/Telegram.Bot.Extensions.Passport/blob/master/src/Quickstart/EncryptionKeyParameters.cs">EncryptionKeyParameters</a> is just a copy of <a href="https://docs.microsoft.com/en-us/dotnet/api/system.security.cryptography.rsaparameters?view=netstandard-2.0">RSAParameters</a> struct.
There are inconsistencies in serialization of <a href="https://docs.microsoft.com/en-us/dotnet/api/system.security.cryptography.rsaparameters?view=netstandard-2.0">RSAParameters</a> type on different .NET platforms
and that's why we use our own <a href="https://github.com/TelegramBots/Telegram.Bot.Extensions.Passport/blob/master/src/Quickstart/EncryptionKeyParameters.cs">EncryptionKeyParameters</a> type for serialization.</p>
<blockquote>
<p>For instance, compare <code>RSAParameters</code> implementations on <a href="https://referencesource.microsoft.com/#mscorlib/system/security/cryptography/rsa.cs,21">.NET Framework</a> and <a href="https://github.com/dotnet/corefx/blob/master/src/System.Security.Cryptography.Algorithms/src/System/Security/Cryptography/RSAParameters.cs">.NET Core</a>.</p>
</blockquote>
<!-- ----------- -->
<a class="header" href="#telegram-passport-data-decryption---faq" id="telegram-passport-data-decryption---faq"><h1>Telegram Passport Data Decryption - FAQ</h1></a>
<a class="header" href="#what-is-passportdatadecryptionexception" id="what-is-passportdatadecryptionexception"><h2>What is <code>PassportDataDecryptionException</code></h2></a>
<p>Methods on <a href="https://github.com/TelegramBots/Telegram.Bot.Extensions.Passport/blob/master/src/Telegram.Bot.Extensions.Passport/Decryption/IDecrypter.cs"><code>IDecrypter</code></a> might throw <a href="https://github.com/TelegramBots/Telegram.Bot.Extensions.Passport/blob/master/src/Telegram.Bot.Extensions.Passport/Decryption/PassportDataDecryptionException.cs"><code>PassportDataDecryptionException</code></a> exception
if an error happens during decryption.
The exception message tells you what went wrong but there is not much you can do to resolve it.
Maybe let your user know the issue and ask for Passport data again.</p>
<p>It is important to pass each piece of encrypted data, e.g. Id Document, Passport File, etc., with the right
accompanying credentials to decryption methods.</p>
<p>Spot the <em>problem in this code</em> decrypting driver's license files:</p>
<pre><code class="language-c#">byte[] selfieContent = decrypter.DecryptFile(
  encSelfieContent, // byte array of encrypted selfie file
  credentials.SecureData.DriverLicense.FrontSide // WRONG! use selfie file credentials
);
// throws PassportDataDecryptionException: &quot;Data hash mismatch at position 123.&quot;
</code></pre>
<!-- ----------- -->
<a class="header" href="#working-behind-a-proxy" id="working-behind-a-proxy"><h1>Working Behind a Proxy</h1></a>
<p><code>TelegramBotClient</code> allows you to use a proxy for Bot API connections. This guide covers using three different proxy solutions.</p>
<ul>
<li><a href="#http-proxy">HTTP Proxy</a></li>
<li><a href="#socks5-proxy">SOCKS5 Proxy</a></li>
<li><a href="#socks5-proxy-over-tor">SOCKS5 Proxy over Tor (Testing Only)</a></li>
</ul>
<p><img src="docs/tg-network.gif" alt="Telegram Network" /></p>
<blockquote>
<p>If you are in a country, such as Iran, where HTTP and SOCKS proxy connections to Telegram servers are blocked, consider using a VPN, using Tor Network, or hosting your bot in other jurisdictions.</p>
</blockquote>
<a class="header" href="#http-proxy" id="http-proxy"><h2>HTTP Proxy</h2></a>
<p>You can pass an <code>IWebProxy</code> to bot client for HTTP Proxies.</p>
<pre><code class="language-csharp">// using System.Net;

var httpProxy = new WebProxy(address: &quot;https://example.org&quot;, port: 8080) {
  // Credentials if needed:
  Credentials = new NetworkCredential(&quot;USERNMAE&quot;, &quot;PASSWORD&quot;)
};
var botClient = new TelegramBotClient(&quot;YOUR_API_TOKEN&quot;, httpProxy);
</code></pre>
<a class="header" href="#socks5-proxy" id="socks5-proxy"><h2>SOCKS5 Proxy</h2></a>
<p>Unfortunately, there is no built-in support for socks proxies in the .NET Standard libraries.
You can use an external NuGet package: <a href="https://www.nuget.org/packages/HttpToSocks5Proxy/"><code>HttpToSocks5Proxy</code></a> provided by one of our team members.</p>
<pre><code class="language-csharp">// using MihaZupan;

var proxy = new HttpToSocks5Proxy(Socks5ServerAddress, Socks5ServerPort);

// Or if you need credentials for your proxy server:
var proxy = new HttpToSocks5Proxy(
  Socks5ServerAddress, Socks5ServerPort, &quot;USERNAME&quot;, &quot;PASSWORD&quot;
);

// Allows you to use proxies that are only allowing connections to Telegram
// Needed for some proxies
proxy.ResolveHostnamesLocally = true;

var botClient = new TelegramBotClient(&quot;YOUR_API_TOKEN&quot;, proxy);
</code></pre>
<a class="header" href="#socks5-proxy-over-tor" id="socks5-proxy-over-tor"><h2>SOCKS5 Proxy over Tor</h2></a>
<p><strong>Warning: Use for Testing only!</strong></p>
<blockquote>
<p>Do not use this method in a production environment as it has high network latency and poor bandwidth.</p>
</blockquote>
<p>Using Tor, a developer can avoid network restrictions while debugging and testing the code
before a production release.</p>
<ol>
<li>Install <a href="https://www.torproject.org/">Tor Browser</a></li>
<li>Open the <code>torcc</code> file with a text editor (Found in <code>Tor Browser\Browser\TorBrowser\Data\Tor</code>)</li>
<li>Add the following lines: (configurations are described below)
<pre><code class="language-text">EntryNodes {NL}
ExitNodes {NL}
StrictNodes 1
SocksPort 127.0.0.1:9050
</code></pre>
</li>
<li>Look at the <a href="#socks5-proxy">Socks5 proxy</a> example above.</li>
<li>Start the Tor Browser</li>
</ol>
<p>Usage:</p>
<pre><code class="language-csharp">// using MihaZupan;

var botClient = new TelegramBotClient(
  &quot;YOUR_API_TOKEN&quot;,
  new HttpToSocks5Proxy(&quot;127.0.0.1&quot;, 9050)
);
</code></pre>
<blockquote>
<p>Note that Tor has to be active at all times for the bot to work.</p>
</blockquote>
<a class="header" href="#configurations-in-torcc" id="configurations-in-torcc"><h3>Configurations in <code>torcc</code></h3></a>
<pre><code class="language-text">EntryNodes {NL}
ExitNodes {NL}
StrictNodes 1
</code></pre>
<p>These three lines make sure you use nodes from the Netherlands as much as possible to reduce latency.</p>
<p><code>SocksPort 127.0.0.1:9050</code></p>
<p>This line tells tor to listen on port 9050 for any socks connections.
You can change the port to anything you want (9050 is just the default), only make sure to use the same port in your code.</p>
<a class="header" href="#logging" id="logging"><h1>Logging</h1></a>
<a class="header" href="#date-and-time" id="date-and-time"><h2>Date and Time</h2></a>
<p>All <code>DateTime</code> values are now in UTC format. Here are some examples of usage:</p>
<pre><code class="language-csharp">// Use UTC time when making a request
await BotClient.KickChatMemberAsync(
  chatId: -9876,
  userId: 1234,
  untilDate: DateTime.UtcNow.AddDays(2)
);
</code></pre>
<pre><code class="language-csharp">// Convert to local time (not recommended though)
DateTime localTime = update.Message.Date.ToLocalTime();
</code></pre>
<a class="header" href="#keyboard-buttons" id="keyboard-buttons"><h2>Keyboard Buttons</h2></a>
<p>Many keyboard button types are removed from project. It is more convenient to use factory methods on <code>KeyboardButton</code> and <code>InlineKeyboardButton</code> classes.</p>
<p>Here are some examples:</p>
<pre><code class="language-csharp">// Message having an inline keyboard button with URL that redirects to a page
await BotClient.SendTextMessageAsync(
  chatId: -9876,
  text: &quot;Check out the source code&quot;,
  replyMarkup: new InlineKeyboardMarkup(
    InlineKeyboardButton.WithUrl(&quot;Repository&quot;, &quot;https://github.com/TelegramBots/Telegram.Bot&quot;)
  )
);
</code></pre>
<pre><code class="language-csharp">// Message to a private chat having a 2-row reply keyboard
await BotClient.SendTextMessageAsync(
  chatId: 1234,
  text: &quot;Share your contact &amp; location&quot;,
  replyMarkup: new ReplyKeyboardMarkup(
    new [] { KeyboardButton.WithRequestContact(&quot;Share Contact&quot;) },
    new [] { KeyboardButton.WithRequestLocation(&quot;Share Location&quot;) },
  )
);
</code></pre>
<a class="header" href="#getfileasync" id="getfileasync"><h2><code>GetFileAsync()</code></h2></a>
<p>Downloading a file from Telegram Bot API has 2 steps (<a href="https://core.telegram.org/bots/api#getfile">see docs here</a>):</p>
<ol>
<li>Get file info by calling <code>getFile</code></li>
<li>Download file from <code>https://api.telegram.org/file/bot&lt;token&gt;/&lt;file_path&gt;</code></li>
</ol>
<p><code>GetFileAsync()</code> is replaced by 3 methods. Method <code>GetInfoAndDownloadFileAsync()</code> looks very similar to old <code>GetFileAsync()</code>:</p>
<pre><code class="language-csharp">// Gets file info and saves it to &quot;path/to/file.pdf&quot;
using (var fileStream = System.IO.File.OpenWrite(&quot;path/to/file.pdf&quot;))
{
  File fileInfo = await BotClient.GetInfoAndDownloadFileAsync(
    fileId: &quot;BsdfgLg4Khdlsn-bldBD&quot;,
    destination: fileStream
  );
}
</code></pre>
<blockquote>
<p>Note that calling the method <code>GetInfoAndDownloadFileAsync()</code> results in 2 HTTP requests (steps 1 and 2 above) being sent to the Bot API.</p>
</blockquote>
<p>There are two more methods that assist you with downloading files:</p>
<pre><code class="language-csharp">// New version of GetFileAsync() only gets the file info (step 1)
File fileInfo = await BotClient.GetFileAsync(&quot;BsdfgLg4Khdlsn-bldBD&quot;);

// Download file from server (step 2)
using (var fileStream = System.IO.File.OpenWrite(&quot;path/to/file.pdf&quot;)) {
  await BotClient.DownloadFileAsync(
    filePath: fileInfo.FilePath,
    destination: fileStream
  );
}
</code></pre>
<a class="header" href="#getupdatesasync-setwebhookasync" id="getupdatesasync-setwebhookasync"><h2><code>GetUpdatesAsync()</code>, <code>SetWebhookAsync()</code></h2></a>
<p>Value <code>All</code> is removed from enum <code>Telegram.Bot.Types.Enums.UpdateType</code>. In order to get all kind of updates, pass an empty list such as <code>new UpdateType[0]</code> for <code>allowedUpdates</code> argument.</p>
<a class="header" href="#setwebhookasync" id="setwebhookasync"><h2><code>SetWebhookAsync()</code></h2></a>
<p>Parameter <code>url</code> is required. If you intend to remove the webhook, it is recommended to use <code>DeleteWebhookAsync()</code> instead. However, you could achieve the same result by passing <code>string.Empty</code> value to <code>url</code> argument.</p>
<a class="header" href="#answerinlinequeryasync-and-inlinequeryresult" id="answerinlinequeryasync-and-inlinequeryresult"><h2><code>AnswerInlineQueryAsync()</code> and <code>InlineQueryResult</code></h2></a>
<p>Classes <code>InlineQueryResultNew</code> and <code>InlineQueryResultCache</code> are removed. <code>InlineQueryResult</code> has become the only shared base type for all inline query result classes.</p>
<p>Many shared and redundant properties are removed. This might require significant changes to your <code>.cs</code> files if your bot is in <em>inline mode</em>. Fortunately, all input query results now have constructors with only the required properties as their parameters. This is the preferred way to instantiate input query result instances e.g.:</p>
<p>Instead of:</p>
<pre><code class="language-csharp">// bad way. easy to get exceptions
documentResult = new InlineQueryResultDocument
{
  Id = &quot;some-id&quot;,
  Url = &quot;https://example.com/document.pdf&quot;,
  Title = &quot;Some title&quot;,
  MimeType = &quot;application/pdf&quot;
};
</code></pre>
<p>You should use:</p>
<pre><code class="language-csharp">// good way
documentResult = new InlineQueryResultDocument(
  id: &quot;some-id&quot;,
  documentUrl: &quot;https://example.com/document.pdf&quot;,
  title: &quot;Some title&quot;,
  mimeType: &quot;application/pdf&quot;
);
</code></pre>
<a class="header" href="#sendmediagroupasync" id="sendmediagroupasync"><h2><code>SendMediaGroupAsync()</code></h2></a>
<p><code>InputMediaType</code> is renamed to <code>InputMedia</code>.</p>
<blockquote>
<p><em>ToDo</em></p>
</blockquote>
<a class="header" href="#inline-message-overloads" id="inline-message-overloads"><h2>Inline Message Overloads</h2></a>
<p>Many inline message methods have been replaced with their overloads.</p>
<ul>
<li><code>EditInlineMessageTextAsync</code>--&gt; <code>EditMessageTextAsync</code></li>
</ul>
<blockquote>
<p><em>ToDo</em></p>
</blockquote>
<a class="header" href="#filetosend" id="filetosend"><h2><code>FileToSend</code></h2></a>
<p>New classes have replaced <code>FileToSend</code> struct.</p>
<ul>
<li><code>InputFileStream</code>:</li>
<li><code>InputTelegramFile</code>:</li>
<li><code>InputOnlineFile</code>:</li>
</ul>
<p>In many cases, you can use implicit casting to pass parameters.</p>
<pre><code class="language-csharp">Stream stream = System.IO.File.OpenRead(&quot;photo.png&quot;);
message = await BotClient.SendPhotoAsync(&quot;chat id&quot;, stream);

string fileId = &quot;file_id on Telegram servers&quot;;
message = await BotClient.SendPhotoAsync(&quot;chat id&quot;, fileId);
</code></pre>
<blockquote>
<p><em>ToDo</em>. implicit casts</p>
</blockquote>
<a class="header" href="#updatetype-and-messagetype" id="updatetype-and-messagetype"><h2><code>UpdateType</code> and <code>MessageType</code></h2></a>
<p>Values in these two enums are renamed e.g. <code>UpdateType.MessageUpdate</code> is now <code>UpdateType.Message</code>.</p>
<p><code>MessageType.Service</code> is removed. Now each type of message has its own <code>MessageType</code> value e.g. when a chat member leaves a group, corresponding update contains a message type of <code>MessageType.ChatMemberLeft</code> value.</p>
<a class="header" href="#videonote" id="videonote"><h2><code>VideoNote</code></h2></a>
<p>Properties <code>Width</code> and <code>Height</code> are removed. Vide notes are squared and <code>Length</code> property represents both width and height.</p>
<a class="header" href="#constructor-parameters-instead-of-public-setters" id="constructor-parameters-instead-of-public-setters"><h2>Constructor Parameters Instead of Public Setters</h2></a>
<p>Many types now have the required parameters in their constructors. To avoid running into problems or getting exceptions, we recommend providing all required values in the constructor e.g.:</p>
<pre><code class="language-c#">//bad way:
markup = new InlineKeyboardMarkup {
  Keyboard = buttonsArray,
  ResizeKeyboard = true
};

// better:
markup = new InlineKeyboardMarkup(buttonsArray) {
  ResizeKeyboard = true
};
</code></pre>
<a class="header" href="#how-do-i-use-an-httpsocks-proxy" id="how-do-i-use-an-httpsocks-proxy"><h3>How do I use an HTTP/Socks proxy?</h3></a>
<p>Look at the wiki page: <a href="4/proxy.html">Working Behind a Proxy</a>.</p>
<a class="header" href="#i-got-a-409-error-what-do-i-do" id="i-got-a-409-error-what-do-i-do"><h3>I got a '409' error. What do I do?</h3></a>
<p>You are trying to receive updates multiple times at the same time. Either you are calling GetUpdates from two instances of the bot, or you are calling GetUpdates while a web hook is already set. That is not supported by the API, only receive on one instance.</p>
<a class="header" href="#how-do-i-get-the-user-id-from-a-username" id="how-do-i-get-the-user-id-from-a-username"><h3>How do I get the user id from a username?</h3></a>
<p>There is no way to do that with the API directly.
You could store a list of known usernames, mapped to ids.
This is <em>not</em> recommended, because usernames can be changed.</p>
<a class="header" href="#how-do-i-get-updates-in-channels" id="how-do-i-get-updates-in-channels"><h3>How do I get updates in channels?</h3></a>
<p>If you are using polling, you will have to subscribe to the <code>OnUpdate</code> event.
Check the <code>UpdateType</code> of the <code>Update</code>. If it is <code>UpdateType.ChannelPost</code> then the <code>Update.ChannelPost</code> property will be set.</p>
<a class="header" href="#this-faq-doesnt-have-my-question-on-it-where-can-i-get-my-torch-and-pitchfork" id="this-faq-doesnt-have-my-question-on-it-where-can-i-get-my-torch-and-pitchfork"><h3>This FAQ doesn't have my question on it. Where can I get my torch and pitchfork?</h3></a>
<p>Check the <a href="https://core.telegram.org/bots/faq"><code>Bots FAQ by Telegram</code></a> and if that doesn't pan out, feel free to let us know in the <a href="https://t.me/joinchat/B35YY0QbLfd034CFnvCtCA">public group chat</a>.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        

                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                

                
            </nav>

        </div>

        

        

        

        
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        
        
        <script type="text/javascript">
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>
        
        

    </body>
</html>
